





# 创建虚拟机

## 创建虚拟机

1. 下载安装 [VirtualBox](https://www.virtualbox.org/) ，注意要开启CPU虚拟化功能

2. 下载安装 [Vagrant by HashiCorp (vagrantup.com)](https://www.vagrantup.com/)

3. 打开Window Cmd窗口，进入到指定目录，运行 `vagrant init centos/7`，即可在 VirtualBox 中初始化一个centos7系统

4. 下载vagrant的[镜像](https://cloud.centos.org/centos/7/vagrant/x86_64/images/CentOS-7-x86_64-Vagrant-2004_01.VirtualBox.box)

5. 进入下载的目录，使用`vagrant box add centos/7 CentOS-7-x86_64-Vagrant-2004_01.VirtualBox.box`

6. 使用`vagrant up`启动虚拟机，会在当前目录下生成`Vagrantfile`文件，虚拟机`root`用户的密码为**vagrant**

7. 修改指定目录下文件`Vagrantfile`，找到如下位置，将虚拟机IP更改为`192.168.56.10`,然后使用`vagrant up`重新启动

   ```
     # config.vm.network "private_network", ip: "192.168.33.10"
     config.vm.network "private_network",ip: "192.168.56.10"
    
   ```

8. 虚拟机默认只允许ssh登录，为了操作方便，可以配置允许账号密码登录。需要先使用`vagrant ssh`连接到虚拟机

   ```
   # 进入虚拟机
   vagrant ssh
   # 编辑ssh配置文件
   sudo vi /etc/ssh/sshd_config
   ```

   - 修改`PasswordAuthentication`为`yes`
   - 重启服务 `sudo service sshd restart`

9. 之后就可以使用Xshell等ssh工具连接虚拟机，用户名和密码都是vagrant，为方便管理，我们新建一个用户用来操作虚拟机。

## 新建用户

###  添加用户

1. 添加新用户 `blog`

   ```
   sudo useradd blog
   ```

2. 设置密码

   ```
   sudo passwd blog
   # 根据提示输入两次密码
   ```

3. 为该用户指定主目录(**第1步会默认创建，无需更改**)

   ```
   usermod -d /home/username username
   ```

### 授予sudo的权限

1. 查看sudo配置文件权限

   ```bash
   ls -l /etc/sudoers
   ```

2. 添加`w`权限

   ```bash
   sudo chmod u+w /etc/sudoers
   ```

3. 编辑`sudoers`文件，添加用户

   ```bash
   sudo vi /etc/sudoers
   ```

   找到文件中的如下内容，复制一行并将root修改为要修改的账户

   ```
   Allow root to run any commands anywhere
   root    ALL=(ALL)       ALL
   ```

4. 将写权限收回

   ```bash
   sudo chmod u-w /etc/sudoers
   ```

### 更改文件所有者及组

- 更改所有者

  ```bash
  chown blog FILE
  ```

- 更改文件所属组信息

  ```bash
  chgrp {GROUP} FILE 
  ```

  



## 修改软件源

- 检查是否安装`wget`，如果没有进行安装`sudo yum install -y wget`



- 进入目录`/etc/yum.repos.d`，备份原软件源文件

```bash
[blog@localhost yum.repos.d]$ sudo mv CentOS-Base.repo CentOS-Base.repo.backup
```



- 下载软件源文件 

```bash
sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
```



- 清除缓存 `sudo yum makecache`



- 加载缓存`sudo yum repolist`

